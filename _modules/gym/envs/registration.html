<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gym.envs.registration &mdash; gym-electric-motor 2021 documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> gym-electric-motor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Gym Electric Motor Readme:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/readme.html">Readme File</a></li>
</ul>
<p class="caption"><span class="caption-text">gym-electric-motor Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/environments/environment.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/reference_generators/reference_generator.html">Reference Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/reward_functions/reward_function.html">Reward Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/physical_systems/physical_system.html">Physical Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/visualizations/visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/constraint_monitor.html">Constraint Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/callbacks.html">Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parts/random_component.html">Random Component</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">gym-electric-motor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>gym.envs.registration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gym.envs.registration</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">SupportsFloat</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">gym.envs.__relocated__</span> <span class="kn">import</span> <span class="n">internal_env_relocation_map</span>
<span class="kn">from</span> <span class="nn">gym.utils.env_checker</span> <span class="kn">import</span> <span class="n">check_env</span>
<span class="kn">from</span> <span class="nn">gym.wrappers</span> <span class="kn">import</span> <span class="n">AutoResetWrapper</span><span class="p">,</span> <span class="n">OrderEnforcing</span><span class="p">,</span> <span class="n">TimeLimit</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">importlib_metadata</span> <span class="k">as</span> <span class="nn">metadata</span>  <span class="c1"># type: ignore</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">importlib.metadata</span> <span class="k">as</span> <span class="nn">metadata</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">gym</span> <span class="kn">import</span> <span class="n">Env</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">logger</span>

<span class="n">ENV_ID_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;^(?:(?P&lt;namespace&gt;[\w:-]+)\/)?(?:(?P&lt;name&gt;[\w:.-]+?))(?:-v(?P&lt;version&gt;\d+))?$&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
    <span class="n">mod_name</span><span class="p">,</span> <span class="n">attr_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">mod_name</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fn</span>


<span class="k">def</span> <span class="nf">parse_env_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Parse environment ID string format.</span>

<span class="sd">    This format is true today, but it&#39;s *not* an official spec.</span>
<span class="sd">    [namespace/](env-name)-v(version)    env-name is group 1, version is group 2</span>

<span class="sd">    2016-10-31: We&#39;re experimentally expanding the environment ID format</span>
<span class="sd">    to include an optional namespace.</span>

<span class="sd">    Args:</span>
<span class="sd">        id: The environment id to parse</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple of environment namespace, environment name and version number</span>

<span class="sd">    Raises:</span>
<span class="sd">        Error: If the environment id does not a valid environment regex</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">ENV_ID_RE</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Malformed environment ID: </span><span class="si">{id}</span><span class="s2">.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(Currently all IDs must be of the form [namespace/](env-name)-v(version). (namespace is optional))&quot;</span>
        <span class="p">)</span>
    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span>


<span class="k">def</span> <span class="nf">get_env_id</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the full env ID given a name and (optional) version and namespace. Inverse of :meth:`parse_env_id`.</span>

<span class="sd">    Args:</span>
<span class="sd">        ns: The environment namespace</span>
<span class="sd">        name: The environment name</span>
<span class="sd">        version: The environment version</span>

<span class="sd">    Returns:</span>
<span class="sd">        The environment id</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">full_name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">full_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;-v</span><span class="si">{version}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">ns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">full_name</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">full_name</span>
    <span class="k">return</span> <span class="n">full_name</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">EnvSpec</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">entry_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">reward_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">nondeterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_episode_steps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">order_enforce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">autoreset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize namespace, name, version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">parse_env_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">:</span>
        <span class="c1"># For compatibility purposes</span>
        <span class="k">return</span> <span class="n">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_namespace_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Check if a namespace exists. If it doesn&#39;t, print a helpful error message.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">namespaces</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">namespaces</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">suggestion</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">namespaces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">suggestion_msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Did you mean: `</span><span class="si">{suggestion[0]}</span><span class="s2">`?&quot;</span>
        <span class="k">if</span> <span class="n">suggestion</span>
        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Have you installed the proper package for </span><span class="si">{ns}</span><span class="s2">?&quot;</span>
    <span class="p">)</span>

    <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">NamespaceNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Namespace </span><span class="si">{ns}</span><span class="s2"> not found. </span><span class="si">{suggestion_msg}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_name_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if an env exists in a namespace. If it doesn&#39;t, print a helpful error message.&quot;&quot;&quot;</span>
    <span class="n">_check_namespace_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">spec_</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="n">ns</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">internal_env_relocation_map</span><span class="p">:</span>
        <span class="n">relocated_namespace</span><span class="p">,</span> <span class="n">relocated_package</span> <span class="o">=</span> <span class="n">internal_env_relocation_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The environment `</span><span class="si">{name}</span><span class="s2">` has been moved out of Gym to the package `</span><span class="si">{relocated_package}</span><span class="s2">`.&quot;</span>

        <span class="c1"># Check if the package is installed</span>
        <span class="c1"># If not instruct the user to install the package and then how to instantiate the env</span>
        <span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">relocated_package</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; Please install the package via `pip install </span><span class="si">{relocated_package}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Otherwise the user should be able to instantiate the environment directly</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="o">!=</span> <span class="n">relocated_namespace</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; You can instantiate the new namespaced environment as `</span><span class="si">{relocated_namespace}</span><span class="s2">/</span><span class="si">{name}</span><span class="s2">`.&quot;</span>

        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">NameNotFound</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">suggestion</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">namespace_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; in namespace </span><span class="si">{ns}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">ns</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">suggestion_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Did you mean: `</span><span class="si">{suggestion[0]}</span><span class="s2">`?&quot;</span> <span class="k">if</span> <span class="n">suggestion</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">NameNotFound</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Environment </span><span class="si">{name}</span><span class="s2"> doesn&#39;t exist</span><span class="si">{namespace_msg}</span><span class="s2">. </span><span class="si">{suggestion_msg}</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_version_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Check if an env version exists in a namespace. If it doesn&#39;t, print a helpful error message.</span>
<span class="sd">    This is a complete test whether an environment identifier is valid, and will provide the best available hints.</span>

<span class="sd">    Args:</span>
<span class="sd">        ns: The environment namespace</span>
<span class="sd">        name: The environment space</span>
<span class="sd">        version: The environment version</span>

<span class="sd">    Raises:</span>
<span class="sd">        DeprecatedEnv: The environment doesn&#39;t exist but a default version does</span>
<span class="sd">        VersionNotFound: The ``version`` used doesn&#39;t exist</span>
<span class="sd">        DeprecatedEnv: Environment version is deprecated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">get_env_id</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span> <span class="ow">in</span> <span class="n">registry</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">_check_name_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Environment version `v</span><span class="si">{version}</span><span class="s2">` for environment `{get_env_id(ns, name, None)}` doesn&#39;t exist.&quot;</span>

    <span class="n">env_specs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">spec_</span>
        <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="n">ns</span> <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span>
    <span class="p">]</span>
    <span class="n">env_specs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">env_specs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">spec_</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">default_spec</span> <span class="o">=</span> <span class="p">[</span><span class="n">spec_</span> <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">env_specs</span> <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">default_spec</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; It provides the default version </span><span class="si">{default_spec[0].id}</span><span class="s2">`.&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">env_specs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">DeprecatedEnv</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># Process possible versioned environments</span>

    <span class="n">versioned_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">spec_</span> <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">env_specs</span> <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">latest_spec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">versioned_specs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="k">if</span> <span class="n">latest_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="n">latest_spec</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="n">version_list_msg</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`v</span><span class="si">{spec_.version}</span><span class="s2">`&quot;</span> <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">env_specs</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; It provides versioned environments: [ </span><span class="si">{version_list_msg}</span><span class="s2"> ].&quot;</span>

        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">VersionNotFound</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">latest_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="n">latest_spec</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">DeprecatedEnv</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Environment version v</span><span class="si">{version}</span><span class="s2"> for `{get_env_id(ns, name, None)}` is deprecated. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Please use `</span><span class="si">{latest_spec.id}</span><span class="s2">` instead.&quot;</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">find_highest_version</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">spec_</span><span class="o">.</span><span class="n">version</span>
        <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="n">ns</span> <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_env_plugins</span><span class="p">(</span><span class="n">entry_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gym.envs&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Load third-party environments</span>
    <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">entry_point</span><span class="p">):</span>
        <span class="c1"># Python 3.8 doesn&#39;t support plugin.module, plugin.attr</span>
        <span class="c1"># So we&#39;ll have to try and parse this ourselves</span>
        <span class="n">module</span><span class="p">,</span> <span class="n">attr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">module</span><span class="p">,</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">plugin</span><span class="o">.</span><span class="n">attr</span>  <span class="c1"># type: ignore  ## error: Cannot access member &quot;attr&quot; for type &quot;EntryPoint&quot;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">plugin</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">module</span><span class="p">,</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">module</span><span class="p">,</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;While trying to load plugin `</span><span class="si">{plugin}</span><span class="s2">` from </span><span class="si">{entry_point}</span><span class="s2">, an exception occurred: </span><span class="si">{e}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">module</span><span class="p">,</span> <span class="n">attr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Gym environment plugin `</span><span class="si">{module}</span><span class="s2">` must specify a function to execute, not a root module&quot;</span>
                <span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">namespace</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
            <span class="c1"># `__internal__` is an artifact of the plugin system when</span>
            <span class="c1"># the root namespace had an allow-list. The allow-list is now</span>
            <span class="c1"># removed and plugins can register environments in the root</span>
            <span class="c1"># namespace with the `__root__` magic key.</span>
            <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__root__&quot;</span> <span class="ow">or</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__internal__&quot;</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The environment namespace magic key `</span><span class="si">{plugin.name}</span><span class="s2">` is unsupported. &quot;</span>
                    <span class="s2">&quot;To register an environment at the root namespace you should specify &quot;</span>
                    <span class="s2">&quot;the `__root__` namespace.&quot;</span>
                <span class="p">)</span>

        <span class="k">with</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fn</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<span class="c1"># fmt: off</span>
<span class="c1"># Classic control</span>
<span class="c1"># ----------------------------------------</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CartPole-v0&quot;</span><span class="p">,</span> <span class="s2">&quot;CartPole-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;MountainCar-v0&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;MountainCarContinuous-v0&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">]]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Pendulum-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">]]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Acrobot-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>

<span class="c1"># Box2d</span>
<span class="c1"># ----------------------------------------</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;LunarLander-v2&quot;</span><span class="p">,</span> <span class="s2">&quot;LunarLanderContinuous-v2&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BipedalWalker-v3&quot;</span><span class="p">,</span> <span class="s2">&quot;BipedalWalkerHardcore-v3&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">]]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CarRacing-v1&quot;</span><span class="p">,</span> <span class="s2">&quot;CarRacingDomainRandomize-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SupportsFloat</span><span class="p">]]]:</span> <span class="o">...</span>

<span class="c1"># Toy Text</span>
<span class="c1"># ----------------------------------------</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Blackjack-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FrozenLake-v1&quot;</span><span class="p">,</span> <span class="s2">&quot;FrozenLake8x8-v1&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CliffWalking-v0&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Taxi-v3&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span> <span class="o">...</span>

<span class="c1"># Mujoco</span>
<span class="c1"># ----------------------------------------</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
    <span class="s2">&quot;Reacher-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Pusher-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Thrower-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Striker-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InvertedPendulum-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InvertedDoublePendulum-v2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HalfCheetah-v2&quot;</span><span class="p">,</span> <span class="s2">&quot;HalfCheetah-v3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hopper-v2&quot;</span><span class="p">,</span> <span class="s2">&quot;Hopper-v3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Swimmer-v2&quot;</span><span class="p">,</span> <span class="s2">&quot;Swimmer-v3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Walker2d-v2&quot;</span><span class="p">,</span> <span class="s2">&quot;Walker2d-v3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ant-v2&quot;</span>
<span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span> <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">EnvSpec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># fmt: on</span>


<span class="k">class</span> <span class="nc">EnvRegistry</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A glorified dictionary for compatibility reasons.</span>

<span class="sd">    Turns out that some existing code directly used the old `EnvRegistry` code,</span>
<span class="sd">    even though the intended API was just `register` and `make`.</span>
<span class="sd">    This reimplements some old methods, so that e.g. pybullet environments will still work.</span>

<span class="sd">    Ideally, nobody should ever use these methods, and they will be removed soon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: remove this at 1.0</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.make` method is deprecated. Please use `gym.make` instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">make</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.register` method is deprecated. Please use `gym.register` instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">register</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">EnvSpec</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.all` method is deprecated. Please use `registry.values` instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvSpec</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.spec` method is deprecated. Please use `gym.spec` instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">spec</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.namespace` method is deprecated. Please use `gym.namespace` instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">namespace</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">env_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The `registry.env_specs` property along with `EnvSpecTree` is deprecated. Please use `registry` directly as a dictionary instead.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="c1"># Global registry of environments. Meant to be accessed through `register` and `make`</span>
<span class="n">registry</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EnvSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnvRegistry</span><span class="p">()</span>
<span class="n">current_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_check_spec_register</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">EnvSpec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether the spec is valid to be registered. Helper function for `register`.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">registry</span><span class="p">,</span> <span class="n">current_namespace</span>
    <span class="k">if</span> <span class="n">current_namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Custom namespace `</span><span class="si">{spec.namespace}</span><span class="s2">` is being overridden &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;by namespace `</span><span class="si">{current_namespace}</span><span class="s2">`. If you are developing a &quot;</span>
                <span class="s2">&quot;plugin you shouldn&#39;t specify a namespace in `register` &quot;</span>
                <span class="s2">&quot;calls. The namespace is specified through the &quot;</span>
                <span class="s2">&quot;entry point package metadata.&quot;</span>
            <span class="p">)</span>

    <span class="n">latest_versioned_spec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">spec_</span>
            <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span>
            <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">spec</span><span class="o">.</span><span class="n">name</span>
            <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">spec_</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec_</span><span class="o">.</span><span class="n">version</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">unversioned_spec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">spec_</span>
            <span class="k">for</span> <span class="n">spec_</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="n">spec</span><span class="o">.</span><span class="n">namespace</span>
            <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">spec</span><span class="o">.</span><span class="n">name</span>
            <span class="ow">and</span> <span class="n">spec_</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">),</span>
        <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">unversioned_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">RegistrationError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t register the versioned environment &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{spec.id}</span><span class="s2">` when the unversioned environment &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{unversioned_spec.id}</span><span class="s2">` of the same name already exists.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">latest_versioned_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">RegistrationError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t register the unversioned environment &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{spec.id}</span><span class="s2">` when the versioned environment &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{latest_versioned_spec.id}</span><span class="s2">` of the same name &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;already exists. Note: the default behavior is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;that `gym.make` with the unversioned environment &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;will return the latest versioned environment&quot;</span>
        <span class="p">)</span>


<span class="c1"># Public API</span>


<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">namespace</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">current_namespace</span>
    <span class="n">old_namespace</span> <span class="o">=</span> <span class="n">current_namespace</span>
    <span class="n">current_namespace</span> <span class="o">=</span> <span class="n">ns</span>
    <span class="k">yield</span>
    <span class="n">current_namespace</span> <span class="o">=</span> <span class="n">old_namespace</span>


<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register an environment with gym.</span>

<span class="sd">    The `id` parameter corresponds to the name of the environment, with the syntax as follows:</span>
<span class="sd">    `(namespace)/(env_name)-v(version)` where `namespace` is optional.</span>

<span class="sd">    It takes arbitrary keyword arguments, which are passed to the `EnvSpec` constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        id: The environment id</span>
<span class="sd">        **kwargs: arbitrary keyword arguments which are passed to the environment constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">registry</span><span class="p">,</span> <span class="n">current_namespace</span>
    <span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">parse_env_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">current_namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Custom namespace `{kwargs.get(&#39;namespace&#39;)}` is being overridden &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;by namespace `</span><span class="si">{current_namespace}</span><span class="s2">`. If you are developing a &quot;</span>
                <span class="s2">&quot;plugin you shouldn&#39;t specify a namespace in `register` &quot;</span>
                <span class="s2">&quot;calls. The namespace is specified through the &quot;</span>
                <span class="s2">&quot;entry point package metadata.&quot;</span>
            <span class="p">)</span>
        <span class="n">ns_id</span> <span class="o">=</span> <span class="n">current_namespace</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ns_id</span> <span class="o">=</span> <span class="n">ns</span>

    <span class="n">full_id</span> <span class="o">=</span> <span class="n">get_env_id</span><span class="p">(</span><span class="n">ns_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">EnvSpec</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">full_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_check_spec_register</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">registry</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overriding environment </span><span class="si">{spec.id}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">registry</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span>


<div class="viewcode-block" id="make"><a class="viewcode-back" href="../../../parts/utils.html#gym_electric_motor.utils.make">[docs]</a><span class="k">def</span> <span class="nf">make</span><span class="p">(</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EnvSpec</span><span class="p">],</span>
    <span class="n">max_episode_steps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">autoreset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">disable_env_checker</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Env</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create an environment according to the given ID.</span>

<span class="sd">    Warnings:</span>
<span class="sd">        In v0.24, `gym.utils.env_checker.env_checker` is run for every initialised environment.</span>
<span class="sd">        This calls the :meth:`Env.reset`, :meth:`Env.step` and :meth:`Env.render` functions to valid</span>
<span class="sd">        if they follow the gym API. To disable this feature, set parameter `disable_env_checker=True`.</span>

<span class="sd">    Args:</span>
<span class="sd">        id: Name of the environment. Optionally, a module to import can be included, eg. &#39;module:Env-v0&#39;</span>
<span class="sd">        max_episode_steps: Maximum length of an episode (TimeLimit wrapper).</span>
<span class="sd">        autoreset: Whether to automatically reset the environment after each episode (AutoResetWrapper).</span>
<span class="sd">        disable_env_checker: If to disable the environment checker</span>
<span class="sd">        kwargs: Additional arguments to pass to the environment constructor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An instance of the environment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Error: If the ``id`` doesn&#39;t exist then an error is raised</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">EnvSpec</span><span class="p">):</span>
        <span class="n">spec_</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">module</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">id</span> <span class="k">else</span> <span class="nb">id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ModuleNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{e}</span><span class="s2">. Environment registration via importing a module failed. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Check whether &#39;</span><span class="si">{module}</span><span class="s2">&#39; contains env registration and can be imported.&quot;</span>
                <span class="p">)</span>
        <span class="n">spec_</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">parse_env_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">latest_version</span> <span class="o">=</span> <span class="n">find_highest_version</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">latest_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">latest_version</span> <span class="o">&gt;</span> <span class="n">version</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The environment </span><span class="si">{id}</span><span class="s2"> is out of date. You should consider &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;upgrading to version `v</span><span class="si">{latest_version}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">latest_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">latest_version</span>
            <span class="n">new_env_id</span> <span class="o">=</span> <span class="n">get_env_id</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
            <span class="n">spec_</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_env_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Using the latest versioned environment `</span><span class="si">{new_env_id}</span><span class="s2">` &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;instead of the unversioned environment `</span><span class="si">{id}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">spec_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_check_version_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No registered env with id: </span><span class="si">{id}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">_kwargs</span> <span class="o">=</span> <span class="n">spec_</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># TODO: add a minimal env checker on initialization</span>
    <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">entry_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{spec_.id}</span><span class="s2"> registered but entry_point is not specified&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">spec_</span><span class="o">.</span><span class="n">entry_point</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">spec_</span><span class="o">.</span><span class="n">entry_point</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Assume it&#39;s a string</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">spec_</span><span class="o">.</span><span class="n">entry_point</span><span class="p">)</span>

    <span class="n">env</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>

    <span class="n">spec_</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">spec_</span><span class="p">)</span>
    <span class="n">spec_</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">_kwargs</span>

    <span class="n">env</span><span class="o">.</span><span class="n">unwrapped</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec_</span>

    <span class="k">if</span> <span class="n">spec_</span><span class="o">.</span><span class="n">order_enforce</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">OrderEnforcing</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_episode_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">TimeLimit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">max_episode_steps</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spec_</span><span class="o">.</span><span class="n">max_episode_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">TimeLimit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">spec_</span><span class="o">.</span><span class="n">max_episode_steps</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">autoreset</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">AutoResetWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">disable_env_checker</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">check_env</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Env check failed with the following message: </span><span class="si">{e}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;You can set `disable_env_checker=True` to disable this check.&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">env</span></div>


<span class="k">def</span> <span class="nf">spec</span><span class="p">(</span><span class="n">env_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvSpec</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the spec for the given environment from the global registry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec_</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">parse_env_id</span><span class="p">(</span><span class="n">env_id</span><span class="p">)</span>
        <span class="n">_check_version_exists</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No registered env with id: </span><span class="si">{env_id}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_</span><span class="p">,</span> <span class="n">EnvSpec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Praneeth Balakrishna, Gerrit Book, Felix Book, Darius Jakobeit, Wilhelm Kirchgässner, Maximilian Schenke, Arne Traue, Oliver Wallscheid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>